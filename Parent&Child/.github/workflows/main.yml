name: Docker Build & Deploy - Parent Workflow

# Triggers on push to main or manual trigger
on:
  push:
    branches:
      - main
  workflow_dispatch:

env:
  ACR_NAME: ${{ secrets.ACR_NAME }}
  ACR_LOGIN_SERVER: ${{ secrets.ACR_LOGIN_SERVER }}
  REPO: ${{ secrets.REPO }}
  ACA_NAME: ${{ secrets.ACA_NAME }}
  ACA_RG: ${{ secrets.ACA_RG }}
  AZURE_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

jobs:
  # Parent job that calls child workflows sequentially
  call-build-workflow:
    uses: ./.github/workflows/build.yml@main
    secrets: inherit
    permissions:
      contents: read
      id-token: write

  call-deploy-workflow:
    needs: call-build-workflow
    uses: ./.github/workflows/deploy.yml@main
    secrets: inherit
    permissions:
      contents: read
      id-token: write
